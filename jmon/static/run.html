<html>
    <head>
        <link rel="stylesheet" href="/static/css/pico.min.css">
        <style>
            .success-row > td {
                background-color: #ccffcc;
            }
            .failure-row > td {
                background-color: #ffcccc;
            }
            .artifact-image {
                border-color: black;
                border-style: solid;
                border-width: 1px;

                max-height: 400px;
                max-width: 30%;
            }
        </style>
        <script src="/static/js/jquery.min.js"></script>
        <script>
            // Get check from params
            var urlParams = new URLSearchParams(window.location.search);
            let checkName = urlParams.get('check');
            let timestamp = urlParams.get('timestamp');

            $('#run-title').text(`${checkName}: ${timestamp}`);

            let artifactBaseUrl = `/api/v1/checks/${checkName}/runs/${timestamp}/artifacts/`;

            $.get(`/api/v1/checks/${checkName}/runs/${timestamp}`).then((run) => {
                $('#run-status').text(`Status: ${run.status == true ? "Success" : "Failure"}`)
                
                // Obtain run log, if it exists
                if (run.artifacts.indexOf('artifact.log') !== -1) {
                    $.get(`${artifactBaseUrl}/artifact.log`).then((runLog) => {
                        $('#run-log').text(runLog)
                    })
                }

                run.artifacts.forEach((artifactName) => {
                    if (artifactName.indexOf('.png', artifactName.length - 4) !== -1) {
                        $('#artifacts').append(`
                            <div>
                                <a href="${artifactBaseUrl}/${artifactName}">
                                    <span>${artifactName}</span>
                                    <img src="${artifactBaseUrl}/${artifactName}" class="artifact-image" />
                                </a>
                            </div>
                        `);
                    }
                });
            })
        </script>
    </head>
    <body>
        <h2 id="run-title"></h2>
        <h3 id="run-status"></h3>
        <span>Log</span>
        <code >
            <pre id="run-log">

            </pre>
        </code>
        <div id="artifacts" class="grid">
        </div>

    </body>
</html>